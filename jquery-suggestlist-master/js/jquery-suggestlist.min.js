(function(d){function b(f,e){var g=this;this.element=d(f).attr("autocomplete","off").addClass("suggestlist-input");this.options=d.extend(d.fn.suggestlist.defaults,e);this.picker=c.render(e).on("click.suggestlist","li",d.proxy(this.clickLi,this));this.isInput=this.element.is("input");this.destroy=function(){g.hide();g.picker.remove();g.element.off(".suggestlist").removeData("suggestlist")};this.picker.width(this.element.outerWidth());d(document).on("mousedown.suggestlist",function(h){if(d(h.target).closest(".suggestlist, .suggestlist-input").length==0){g.hide()}});if(this.isInput){this.element.on({"focus.suggestlist":d.proxy(this.show,this),"click.suggestlist":d.proxy(this.click,this),"keydown.suggestlist":d.proxy(this.keydown,this),"keyup.suggestlist":d.proxy(this.updateLi,this)});this.updateLi()}}b.prototype={constructor:b,click:function(){if(this.picker.is(":hidden")){this.show()}},clickLi:function(e){this.picker.find("li.suggestlist-selected").removeClass("suggestlist-selected");d(e.currentTarget).addClass("suggestlist-selected");this.element[0].focus();this.updateVal()},keydown:function(e){switch(e.keyCode){case 27:this.hide();e.preventDefault();break;case 9:this.hide();break;case 38:if(this.picker.is(":not(:visible)")){this.show();return}this.selectPrev();break;case 40:if(this.picker.is(":not(:visible)")){this.show();return}this.selectNext();break;case 13:if(this.picker.is(":visible")){this.updateVal();e.preventDefault()}break}},show:function(e){this.picker.show();this.place();d(window).on("resize.suggestlist",d.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}},hide:function(e){this.picker.hide();d(window).off("resize",d.proxy(this.place,this))},place:function(){var e=this.element.offset();this.picker.css({left:e.left,top:e.top+this.element.outerHeight()})},selectNext:function(){var f,e;f=this.picker.find("li.suggestlist-selected").first();if(f.length===0){e=this.picker.find("li").first()}else{if(f.is(":last-child")){return}e=f.removeClass("suggestlist-selected").next()}e.addClass("suggestlist-selected")},selectPrev:function(){var f,e;f=this.picker.find("li.suggestlist-selected").first();if(f.length===0){e=this.picker.find("li").last()}else{if(f.is(":first-child")){return}e=f.removeClass("suggestlist-selected").prev()}e.addClass("suggestlist-selected")},updateVal:function(){this.element.val(this.picker.find("li.suggestlist-selected").text());this.hide()},updateLi:function(g){if(g){var e=String.fromCharCode(g.keyCode).toLowerCase();if(g.ctrlKey||!/^[0-9a-z ]$/.test(e)){return}}var h=d.trim(this.element.val()).replace(/\s+/," "),i=this.picker.find("li"),f=i.filter(".suggestlist-selected").first();if(h===f.text()){return}if(d.inArray(h,this.options.list)===-1){return false}f.removeClass("suggestlist-selected");this.picker.find("li").each(function(j,k){if(d(k).text()===h){d(k).addClass("suggestlist-selected")}});if(g){this.show()}}};var c={render:function(f){var e=d("<ul/>"),g;e.addClass("suggestlist").css({zIndex:a(this.element)});for(g=0;g<f.list.length;g++){e.append("<li>"+f.list[g]+"</li>");if(g===0){e.addClass("suggestlist-selected")}}e.appendTo("body");return e}};function a(e){if(!e){return}return parseInt(e.parents().filter(function(){return d(this).css("z-index")!=="auto"}).first().css("z-index"),10)}d.fn.suggestlist=function(f){var e=Array.apply(null,arguments);e.shift();return this.each(function(){var i=d(this),h=i.data("suggestlist"),g=typeof f=="object"&&f;if(!h){h=new b(this,d.extend({},d.fn.suggestlist.defaults,g));i.data("suggestlist",h)}if(typeof f=="string"&&typeof h[f]=="function"){h[f].apply(h,e)}})};d.fn.suggestlist.defaults={list:[]}})(jQuery);